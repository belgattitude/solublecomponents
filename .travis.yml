language: php

php:
  - 5.4
  - 5.5

env:
  - DB=mysql

before_script:
  - printf "\n" | pecl install imagick
  - mkdir -p tests/tmp/cache 
  - if [[ "$DB" == "mysql" ]]; then mysql -e "DROP DATABASE IF EXISTS phpunit_soluble_test_db;" -uroot; fi
  - if [[ "$DB" == "mysql" ]]; then mysql -e "create database phpunit_soluble_test_db;" -uroot; fi
  - if [[ "$DB" == "mysql" ]]; then zcat tests/data/mysql/schema.sql.gz | mysql -uroot phpunit_soluble_test_db; fi
  - if [[ "$DB" == "mysql" ]]; then zcat tests/data/mysql/data.sql.gz | mysql -uroot phpunit_soluble_test_db; fi
  - sh -c "pwd"
  - sh -c "which zcat"
  - sh -c "which php"
  - sh -c "php -m"
  - mysql -e "show databases;" -uroot
  - mysql -e "connect phpunit_soluble_test_db; show tables;" -uroot
  - composer install --prefer-dist --dev
  #- sudo apt-get install jpegoptim libjpeg-progs optipng

script: 
  - phpunit -v --configuration tests/travis/$DB.travis.xml 
  - php coverage-checker.php tests/build/logs/clover.xml 75

